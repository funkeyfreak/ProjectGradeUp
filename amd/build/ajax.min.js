define(["jquery","core/ajax","core/log","block_projectgradeup/core"],function(a,b,c,d){d=d.strings;var e=function(b,c){b="undefined"==typeof b?a(d.hiddenUserId)[0].value:b,c="undefined"==typeof c?a(d.hiddenCourseId)[0].value:c,this.userId=b,this.courseId=c},f={USER_ERROR:10,CODE_ERROR:11,PARAM_ERROR:12,OTHER_ERROR:13};e.prototype={typeCheckFunctions:function(a,b){if("function"!=typeof a)throw b;return!0},typeCheckRequestType:function(a){if("undefined"==typeof a)return"single";switch(a){case"single":case"course":case"all":return a;default:return"single"}},typeCheckFormat:function(a){switch(a){case"string":break;case"json":d.checkVersion(2)||(a="string");break;default:a="string"}return a},typeCheckResolution:function(b,e){if("undefined"==typeof e&&(e="none"),"undefined"==typeof b)b={},"heatmap"==e?(b.width=0==document.getElementById(d.heatmapPresentationDivId).offsetWidth?1080:document.getElementById(d.heatmapPresentationDivId).offsetWidth,b.height=.25*b.width):"burnup"==e?(b.width=0==document.getElementById(d.burnupPresentationDivId).offsetWidth?1080:.9*document.getElementById(d.burnupPresentationDivId).offsetWidth,b.height=2/3*b.width*.9):(b.height=0==a(d.heatmapPresentationDiv).innerWidth()?720:a(d.heatmapPresentationDiv).innerWidth(),b.width=0==a(d.heatmapPresentationDiv).innerHeight()?1080:a(d.heatmapPresentationDiv).innerHeight());else if("width"in b&&"height"in b){if(Array.isArray(b)&&2==b.length){var f;try{f=b.reduce(function(a,b,c){return a[c]=b,a},{}),b=f}catch(g){c.debug(g)}finally{b={},"heatmap"==e?(b.width=0==document.getElementById(d.heatmapPresentationDivId).offsetWidth?1080:document.getElementById(d.heatmapPresentationDivId).offsetWidth,b.height=.25*b.width):"burnup"==e?(b.width=0==document.getElementById(d.burnupPresentationDivId).offsetWidth?1080:.9*document.getElementById(d.burnupPresentationDivId).offsetWidth,b.height=2/3*b.width*.9):(b.width=a(d.heatmapPresentationDiv).innerHeight(),b.height=a(d.heatmapPresentationDiv).innerHeight())}}}else b={},"heatmap"==e?(b.width=0==document.getElementById(d.heatmapPresentationDivId).offsetWidth?1080:document.getElementById(d.heatmapPresentationDivId).offsetWidth,b.height=.25*b.width):"burnup"==e?(b.width=0==document.getElementById(d.burnupPresentationDivId).offsetWidth?1080:.9*document.getElementById(d.burnupPresentationDivId).offsetWidth,b.height=2/3*b.width*.9):(b.height=0==a(d.heatmapPresentationDiv).innerWidth()?720:a(d.heatmapPresentationDiv).innerWidth(),b.width=0==a(d.heatmapPresentationDivId).innerHeight()?1080:a(d.heatmapPresentationDiv).innerHeight());return b},typeCheckColorBlind:function(b){return"undefined"==typeof b?b=a(d.colorblindCheckBoxId).is(":checked"):"boolean"!=typeof colorblind&&(b=a(d.colorblindCheckBoxId).is(":checked")),b?1:0},typeCheckRequestName:function(a){if("undefined"==typeof a)throw"Undefined request sent | projectgradeup->ajax.js::typeCheckRequestName. Error #"+f.USER_ERROR;switch(a){case"burnup":case"heatmap":case"artifact":return a;default:throw"Unlknown request sent | projectgradeup->ajax.js::typeCheckRequestName. Error #"+f.USER_ERROR}return rn},createHeatmapRequest:function(a,c,e,g,h){if(a=this.typeCheckRequestType(a),this.typeCheckFunctions(c,"ERROR CODE #"+f.CODE_ERROR+"not a valid fucntion for the success callback"),this.typeCheckFunctions(e,"ERROR CODE #"+f.CODE_ERROR+"not a valid fucntion for the fail callback"),h=this.typeCheckColorBlind(h),g=this.typeCheckResolution(g,"heatmap"),!d.checkVersion(2)){var i=this.typeCheckRequestName("heatmap"),j=this.typeCheckFormat();return this.defaultHandler(g,i,a,h,j,c,e),!0}var k=b.call({methodname:"block_projectgradeup/get_heatmap",args:{courseid:this.courseId,userid:this.userId,resolution:g,request:a,colorblind:h}});k.done(c).fail(e)},createBurnupRequest:function(a,c,e,g,h){if(a=this.typeCheckRequestType(a),this.typeCheckFunctions(c,"ERROR CODE #"+f.CODE_ERROR+"not a valid fucntion for the success callback"),this.typeCheckFunctions(e,"ERROR CODE #"+f.CODE_ERROR+"not a valid fucntion for the fail callback"),h=this.typeCheckColorBlind(h),g=this.typeCheckResolution(g,"burnup"),!d.checkVersion(2)){var i=this.typeCheckRequestName("burnup"),j=this.typeCheckFormat();return this.defaultHandler(g,i,a,h,j,c,e),!0}var k=b.call({methodname:"block_projectgradeup/get_burnup",args:{courseid:this.courseId,userid:this.userId,resolution:g,request:a,colorblind:h}});k.done(c).fail(e)},createArtifactRequest:function(a,c,e,g){if(a=this.typeCheckRequestType(a),this.typeCheckFunctions(c,"ERROR CODE #"+f.CODE_ERROR+"not a valid fucntion for the success callback"),this.typeCheckFunctions(e,"ERROR CODE #"+f.CODE_ERROR+"not a valid fucntion for the fail callback"),g=this.typeCheckFormat(g),!d.checkVersion(2)){var h=this.typeCheckRequestName("artifact"),i=this.typeCheckResolution();return this.defaultHandler(i,h,a,0,g,c,e),!0}var j=b.call([{methodname:"block_projectgradeup/get_artifacts",args:{courseid:this.courseId,userid:this.userId,format:g,request:a}}]);j[0].done(c).fail(e)},defaultHandler:function(a,b,d,e,f,g,h){Y.io(M.cfg.wwwroot+"/blocks/projectgradeup/ajax.php?sesskey="+M.cfg.sesskey+"&width="+a.width+"&height="+a.height+"&function="+b+"&request="+d+"&course="+this.courseId+"&name="+this.userId+"&assistance="+e+"&format="+f,{on:{success:function(a,b){c.debug("Success"),g(b.responseText)},failure:function(a,b){c.debug("Failure"),h(b.responseText)}}})}},e.prototype=Object.create(e.prototype),e.prototype.constructor=e;return e});